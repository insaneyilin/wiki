<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/tango.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>C++ 类型转换 - Yilin's Wiki</title>
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          <!--$表示行内元素，$$表示块状元素 -->
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
        },
        "HTML-CSS": { availableFonts: ["TeX"] }
      });
    </script>
    <script type="text/javascript" async
      src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>

    <!--Mermaid流程图-->
    <script src="https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/wiki/">Home</a>&nbsp;&#187;&nbsp;<a href="/wiki/#c++">c++</a>&nbsp;&#187;&nbsp;C++ 类型转换
    <span class="updated">Page Updated&nbsp;
      2020-02-02 12:21
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">C++ 类型转换</div>

  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#static_cast">static_cast</a></li>
<li><a href="#dynamic_cast">dynamic_cast</a></li>
<li><a href="#const_cast">const_cast</a></li>
<li><a href="#reinterpret_cast">reinterpret_cast</a></li>
<li><a href="#_1">参考</a></li>
</ul>
</div>
<hr />
<h2 id="static_cast">static_cast</h2>
<p>一般情况下类型之间的转化用static_cast，能完成大部分工作，不保证安全。</p>
<h2 id="dynamic_cast">dynamic_cast</h2>
<p>针对基类和派生类指针和引用的转换，基类和派生类之间必须要继承关系，是安全的。</p>
<p>在运行时尝试 <strong>将基类指针转化为派生类指针</strong> ，如果失败，会返回 nullptr。</p>
<p>子类到父类的转换是 implicit 的。</p>
<h2 id="const_cast">const_cast</h2>
<p>用于转换 const/非const 指针和引用。常用于去除 const 属性。</p>
<h2 id="reinterpret_cast">reinterpret_cast</h2>
<p>允许将任何指针类型转为其他指针类型，用来处理无关类型之间的转换；它会产生一个新的值，这个值会有与原始参数（expressoin）有完全相同的比特位。</p>
<blockquote>
<p>reinterpret_cast 运算符并不会改变括号中运算对象的值，而是对该对象从位模式上进行重新解释。</p>
</blockquote>
<p>一个例子(处理不透明的数据类型)：</p>
<p>https://stackoverflow.com/questions/573294/when-to-use-reinterpret-cast</p>
<blockquote>
<p>One case when reinterpret_cast is necessary is when interfacing with <strong>opaque data types</strong>. This occurs frequently in vendor APIs over which the programmer has no control. Here's a contrived example where a vendor provides an API for storing and retrieving arbitrary global data:</p>
</blockquote>
<div class="hlcode"><pre><span></span><span class="c1">// vendor.hpp</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_Opaque</span> <span class="o">*</span> <span class="n">VendorGlobalUserData</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">VendorSetUserData</span><span class="p">(</span><span class="n">VendorGlobalUserData</span> <span class="n">p</span><span class="p">);</span>
<span class="n">VendorGlobalUserData</span> <span class="nf">VendorGetUserData</span><span class="p">();</span>


<span class="c1">// main.cpp</span>
<span class="cp">#include</span> <span class="cpf">&quot;vendor.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">MyUserData</span> <span class="p">{</span>
    <span class="n">MyUserData</span><span class="p">()</span> <span class="o">:</span> <span class="n">m</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kt">int</span> <span class="n">m</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">MyUserData</span> <span class="n">u</span><span class="p">;</span>

    <span class="c1">// store global data</span>
    <span class="n">VendorGlobalUserData</span> <span class="n">d1</span><span class="p">;</span>
<span class="c1">//  d1 = &amp;u;                                          // compile error</span>
<span class="c1">//  d1 = static_cast&lt;VendorGlobalUserData&gt;(&amp;u);       // compile error</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">VendorGlobalUserData</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">u</span><span class="p">);</span>  <span class="c1">// ok</span>
    <span class="n">VendorSetUserData</span><span class="p">(</span><span class="n">d1</span><span class="p">);</span>

    <span class="c1">// do other stuff...</span>

    <span class="c1">// retrieve global data</span>
    <span class="n">VendorGlobalUserData</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">VendorGetUserData</span><span class="p">();</span>
    <span class="n">MyUserData</span> <span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">//  p = d2;                                           // compile error</span>
<span class="c1">//  p = static_cast&lt;MyUserData *&gt;(d2);                // compile error</span>
    <span class="n">p</span> <span class="o">=</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">MyUserData</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">d2</span><span class="p">);</span>           <span class="c1">// ok</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">m</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<hr />
<h2 id="_1">参考</h2>
<p>https://zhuanlan.zhihu.com/p/33040213</p>
<p>https://stackoverflow.com/questions/573294/when-to-use-reinterpret-cast</p>
  <div class="relation">
    <h2>Related</h2>
    <ul>
    
    <li><a href="/wiki/c++/cxx_std_io_tips.html">C++ Standard IO tips</a></li>
    
    <li><a href="/wiki/c++/cxx11_multi_thread_and_async.html">C++11 多线程与异步调用</a></li>
    
    <li><a href="/wiki/c++/cxx_practical_tips.html">C++ Practical Tips</a></li>
    
    <li><a href="/wiki/c++/effective_stl_notes.html">Effective STL notes</a></li>
    
    <li><a href="/wiki/c++/eigen_notes.html">Eigen C++ Library cheatsheet</a></li>
    
    </ul>
  </div>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2020 Yilin Gui.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2020-02-07 23:43:24</p>
      </span>
    </div>

    
    
  </body>
</html>